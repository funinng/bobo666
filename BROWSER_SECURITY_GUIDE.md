# æµè§ˆå™¨ç¯å¢ƒä½¿ç”¨ OpenAI SDK å®‰å…¨æŒ‡å—

## é—®é¢˜è¯´æ˜

æ ¹æ® [Ant Design X å®˜æ–¹æ–‡æ¡£](https://x.ant.design/docs/react/model-use-openai-cn?theme=happy-work)ï¼Œ`openai-node` é€šå¸¸ç”¨äº Node.js ç¯å¢ƒã€‚å¦‚æœåœ¨æµè§ˆå™¨ç¯å¢ƒä½¿ç”¨ï¼Œéœ€è¦å¼€å¯ `dangerouslyAllowBrowser` é€‰é¡¹ã€‚

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šå¯ç”¨ dangerouslyAllowBrowserï¼ˆå·²å®ç°ï¼‰

æˆ‘ä»¬å·²ç»åœ¨ `src/services/openai.ts` ä¸­æ·»åŠ äº†æ­¤é€‰é¡¹ï¼š

```typescript
this.client = new OpenAI({
  apiKey: this.config.apiKey,
  baseURL: this.config.baseURL,
  dangerouslyAllowBrowser: true, // å…è®¸åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨
});
```

### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ä»£ç†æœåŠ¡å™¨ï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

æˆ‘ä»¬ä¹Ÿæä¾›äº†ä»£ç†æœåŠ¡å™¨çš„å®ç°ï¼Œä½äº `src/services/openai-proxy.ts`ã€‚

## å®‰å…¨é£é™©è¯´æ˜

âš ï¸ **é‡è¦å®‰å…¨æé†’**ï¼š`dangerouslyAllowBrowser` å­˜åœ¨å®‰å…¨é£é™©ï¼Œæ­£å¦‚ OpenAI å®˜æ–¹æ–‡æ¡£æ‰€è¿°ï¼š

### ä¸»è¦é£é™©

1. **API å¯†é’¥æš´éœ²**ï¼šåœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ä¼šå°† API å¯†é’¥æš´éœ²ç»™ç”¨æˆ·
2. **å¯†é’¥æ³„éœ²**ï¼šæ¶æ„ç”¨æˆ·å¯èƒ½è·å–å¹¶æ»¥ç”¨æ‚¨çš„ API å¯†é’¥
3. **è´¹ç”¨é£é™©**ï¼šå¯èƒ½å¯¼è‡´æ„å¤–çš„ API ä½¿ç”¨è´¹ç”¨

### å®‰å…¨å»ºè®®

#### å¼€å‘ç¯å¢ƒ

- âœ… å¯ä»¥ä½¿ç”¨ `dangerouslyAllowBrowser: true` è¿›è¡Œå¿«é€Ÿå¼€å‘å’Œæµ‹è¯•
- âœ… ç¡®ä¿ä¸è¦å°†çœŸå®çš„ API å¯†é’¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ

#### ç”Ÿäº§ç¯å¢ƒ

- âŒ **ä¸å»ºè®®**åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç›´æ¥ä½¿ç”¨ `dangerouslyAllowBrowser`
- âœ… **æ¨è**ä½¿ç”¨ä»£ç†æœåŠ¡å™¨æ–¹æ¡ˆ
- âœ… åœ¨åç«¯æœåŠ¡å™¨ä¸­å®‰å…¨åœ°ç®¡ç† API å¯†é’¥

## ä»£ç†æœåŠ¡å™¨æ–¹æ¡ˆ

### ä¼˜åŠ¿

- ğŸ”’ API å¯†é’¥å®‰å…¨å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯
- ğŸ›¡ï¸ å¯ä»¥æ·»åŠ è®¿é—®æ§åˆ¶å’Œé€Ÿç‡é™åˆ¶
- ğŸ“Š ä¾¿äºç›‘æ§å’Œæ—¥å¿—è®°å½•
- ğŸ’° æ›´å¥½çš„æˆæœ¬æ§åˆ¶

### ä½¿ç”¨æ­¥éª¤

1. **åˆ›å»ºä»£ç†æœåŠ¡å™¨**

   ```bash
   # ä½¿ç”¨æä¾›çš„ç¤ºä¾‹æ–‡ä»¶
   cp proxy-server-package.json package.json
   npm install
   ```

2. **è®¾ç½®ç¯å¢ƒå˜é‡**

   ```bash
   export OPENAI_API_KEY=your_actual_api_key
   ```

3. **å¯åŠ¨ä»£ç†æœåŠ¡å™¨**

   ```bash
   npm start
   ```

4. **é…ç½®å‰ç«¯åº”ç”¨**
   åœ¨åº”ç”¨ä¸­å¯ç”¨ä»£ç†æ¨¡å¼ï¼š
   ```env
   VITE_OPENAI_USE_PROXY=true
   VITE_OPENAI_PROXY_URL=http://localhost:3001/api/openai
   ```

## é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡

| å˜é‡å                  | æè¿°             | é»˜è®¤å€¼  | å®‰å…¨çº§åˆ«              |
| ----------------------- | ---------------- | ------- | --------------------- |
| `VITE_OPENAI_API_KEY`   | OpenAI API å¯†é’¥  | å¿…å¡«    | âš ï¸ ä¸­ç­‰ï¼ˆæµè§ˆå™¨å¯è§ï¼‰ |
| `VITE_OPENAI_USE_PROXY` | æ˜¯å¦ä½¿ç”¨ä»£ç†æœåŠ¡ | `false` | âœ… å®‰å…¨               |
| `VITE_OPENAI_PROXY_URL` | ä»£ç†æœåŠ¡ URL     | -       | âœ… å®‰å…¨               |

### æ¨èé…ç½®

#### å¼€å‘ç¯å¢ƒ

```env
VITE_OPENAI_API_KEY=sk-test-key-for-development
VITE_OPENAI_USE_PROXY=false
```

#### ç”Ÿäº§ç¯å¢ƒ

```env
VITE_OPENAI_USE_PROXY=true
VITE_OPENAI_PROXY_URL=https://your-api-server.com/api/openai
```

## æœ€ä½³å®è·µ

### 1. å¯†é’¥ç®¡ç†

- ä½¿ç”¨ä¸åŒçš„ API å¯†é’¥ç”¨äºå¼€å‘å’Œç”Ÿäº§
- å®šæœŸè½®æ¢ API å¯†é’¥
- è®¾ç½® API å¯†é’¥çš„ä½¿ç”¨é™åˆ¶

### 2. è®¿é—®æ§åˆ¶

- åœ¨ä»£ç†æœåŠ¡å™¨ä¸­æ·»åŠ èº«ä»½éªŒè¯
- å®ç°é€Ÿç‡é™åˆ¶é˜²æ­¢æ»¥ç”¨
- è®°å½• API ä½¿ç”¨æƒ…å†µ

### 3. é”™è¯¯å¤„ç†

- ä¸è¦åœ¨é”™è¯¯ä¿¡æ¯ä¸­æš´éœ²æ•æ„Ÿä¿¡æ¯
- å®ç°ä¼˜é›…çš„é™çº§æœºåˆ¶
- æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

### 4. ç›‘æ§å’Œå‘Šè­¦

- ç›‘æ§ API ä½¿ç”¨é‡å’Œè´¹ç”¨
- è®¾ç½®å¼‚å¸¸ä½¿ç”¨å‘Šè­¦
- å®šæœŸå®¡æŸ¥è®¿é—®æ—¥å¿—

## ä»£ç ç¤ºä¾‹

### å®‰å…¨çš„ä»£ç†æœåŠ¡å™¨å®ç°

```javascript
// æ·»åŠ èº«ä»½éªŒè¯ä¸­é—´ä»¶
app.use('/api/openai', (req, res, next) => {
  const token = req.headers.authorization;
  if (!isValidToken(token)) {
    return res.status(401).json({ error: 'æœªæˆæƒè®¿é—®' });
  }
  next();
});

// æ·»åŠ é€Ÿç‡é™åˆ¶
const rateLimit = require('express-rate-limit');
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 åˆ†é’Ÿ
  max: 100, // é™åˆ¶æ¯ä¸ª IP 100 æ¬¡è¯·æ±‚
});
app.use('/api/openai', limiter);
```

### å‰ç«¯é”™è¯¯å¤„ç†

```typescript
try {
  const response = await openaiService.chat(request);
  return response;
} catch (error) {
  // ä¸è¦æš´éœ²è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
  console.error('API è°ƒç”¨å¤±è´¥:', error);
  throw new Error('æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•');
}
```

## æ€»ç»“

1. **å¼€å‘é˜¶æ®µ**ï¼šå¯ä»¥ä½¿ç”¨ `dangerouslyAllowBrowser: true` å¿«é€Ÿå¼€å§‹
2. **ç”Ÿäº§éƒ¨ç½²**ï¼šå¼ºçƒˆå»ºè®®ä½¿ç”¨ä»£ç†æœåŠ¡å™¨æ–¹æ¡ˆ
3. **å®‰å…¨ç¬¬ä¸€**ï¼šå§‹ç»ˆå°† API å¯†é’¥å®‰å…¨æ”¾åœ¨é¦–ä½
4. **ç›‘æ§ä½¿ç”¨**ï¼šå®šæœŸæ£€æŸ¥ API ä½¿ç”¨æƒ…å†µå’Œè´¹ç”¨

éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œæ‚¨å¯ä»¥å®‰å…¨åœ°åœ¨ Ant Design X åº”ç”¨ä¸­ä½¿ç”¨ OpenAI æœåŠ¡ã€‚




